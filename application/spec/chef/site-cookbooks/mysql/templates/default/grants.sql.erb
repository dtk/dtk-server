# Generated by Chef. Local modifications will be overwritten.
<% if @db_info -%>
  <% @db_info.each do |env,db| -%>
     <% if db['database'] and db['username'] and db['password'] -%>
# Privileges for databases in <%= env %>
GRANT ALL ON <%= db['database'] %>.* TO '<%= db['username'] %>'@'%' IDENTIFIED BY '<%= db['password'] %>';
      <% if @node[:mysql][:server_readonly_password] %>
GRANT SELECT ON <%= db['database'] %>.* TO 'readonly'@'<%= @node[:fqdn] %>' IDENTIFIED BY '<%= @node[:mysql][:server_readonly_password] %>';
      <% end -%>
    <% end -%>
  <% end -%>
<% end -%>

<% case @node[:platform] -%>
  <% when "debian","ubuntu" -%>
    <% if @node[:mysql][:server_debian_password] -%>
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, SHUTDOWN, PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, SUPER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'debian-sys-maint'@'localhost' IDENTIFIED BY '<%= @node[:mysql][:server_debian_password] %>' WITH GRANT OPTION;
  <% end -%>
<% end -%>

<% if @node.mysql.server_repl_password -%>
# CREATE USER 'repl'@'%' IDENTIFIED BY '<%= @node.mysql.server_repl_password %>';
GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%' IDENTIFIED BY '<%= @node.mysql.server_repl_password %>';
<% end -%>

<% if @node[:mysql][:server_root_password] -%> 
SET PASSWORD FOR 'root'@'localhost' = PASSWORD('<%= @node[:mysql][:server_root_password] %>');
<% end -%> 
flush privileges;
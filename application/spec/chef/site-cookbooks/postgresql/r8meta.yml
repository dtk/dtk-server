--- !omap 
- postgresql__app: !omap 
    - display_name: postgresql__app
    - description: Test app
    - external_ref: 
        type: chef_recipe
        recipe_name: postgresql::app
    - ui: 
        images: 
          tiny: ""
          tnail: postgres.png
          display: postgres.png
    - type: instance
    - basic_type: application
    - component_type: postgresql__app
    - attribute: !omap 
        - db_config: !omap 
            - display_name: db_config
            - data_type: json
            - is_port: true
            - semantic_type_summary: db_config
            - semantic_type: db_config
            - required: true
            - external_ref: 
                type: attribute
                path: db_config
        - sap_ref__l4: !omap 
            - display_name: sap_ref__l4
            - data_type: json
            - is_port: true
            - semantic_type_summary: sap_ref__l4
            - semantic_type: sap_ref__l4
            - required: true
            - dependency: 
                attribute_constraint: 
                  type: attribute
                  search_pattern: 
                    ":filter": 
                    - ":eq"
                    - ":specific_type"
                    - postgres_db_server
                  display_name: attribute_constraint
                  description: Not connecting to Postgres Server
                  severity: error
            - external_ref: 
                type: attribute
                path: sap_ref__l4
- postgresql__db: !omap 
    - display_name: postgresql__db
    - description: Postgresql DB
    - external_ref: 
        type: chef_recipe
        recipe_name: postgresql::db
    - ui: 
        images: 
          tiny: ""
          tnail: database-unknown.png
          display: database-unknown.png
    - type: instance
    - basic_type: database
    - specific_type: postgres_db
    - component_type: postgresql__db
    - only_one_per_node: false
    - attribute: !omap 
        - db_params_ref: !omap 
            - display_name: db_params_ref
            - description: Parameters for a db
            - data_type: json
            - is_port: true
            - semantic_type_summary: db_params
            - semantic_type: db_params
            - external_ref: 
                type: service_attribute
                path: service[postgresql][db_params]
    - extension_type: database
    - "*extended_base_id": /library/test/component/postgresql__server
- postgresql__pgpool: !omap 
    - display_name: postgresql__pgpool
    - description: Installs pgpool load balancer
    - external_ref: 
        type: chef_recipe
        recipe_name: postgresql::pgpool
    - ui: 
        images: 
          tiny: ""
          tnail: postgres.png
          display: postgres.png
    - type: instance
    - basic_type: service
    - specific_type: postgres_db_server
    - component_type: postgresql__pgpool
    - attribute: !omap 
        - conns_to_real_dbs: !omap 
            - display_name: conns_to_real_dbs
            - description: postgres ip service access point configuration
            - data_type: json
            - is_port: true
            - semantic_type_summary: sap_ref__l4
            - semantic_type: 
                ":array": sap_ref__l4
            - dependency: 
                attribute_constraint: 
                  type: attribute
                  search_pattern: 
                    ":filter": 
                    - ":eq"
                    - ":specific_type"
                    - postgres_db_server
                  display_name: component_constraint
                  description: Not connecting to Postgres Server
                  severity: error
            - external_ref: 
                type: service_attribute
                path: service[postgresql][conns_to_real_dbs]
        - sap_config__l4: !omap 
            - display_name: sap_config__l4
            - description: postgres ip service access point configuration
            - data_type: json
            - value_asserted: 
              - port: 5432
                protocol: tcp
            - is_port: true
            - semantic_type_summary: sap_config__l4
            - semantic_type: 
                ":array": sap_config__l4
            - external_ref: 
                type: service_attribute
                path: service[postgresql][sap_config__l4]
- postgresql__server: !omap 
    - display_name: postgresql__server
    - description: Installs postgresql server packages, debian family style
    - external_ref: 
        type: chef_recipe
        recipe_name: postgresql::server
    - ui: 
        images: 
          tiny: ""
          tnail: postgres.png
          display: postgres.png
    - type: instance
    - basic_type: service
    - specific_type: postgres_db_server
    - component_type: postgresql__server
    - attribute: !omap 
        - db_component: !omap 
            - display_name: db_component
            - data_type: string
            - value_asserted: postgresql__db
            - external_ref: 
                type: chef_attribute
                path: node[postgresql][db_component]
        - effective_cache_size: !omap 
            - display_name: effective_cache_size
            - data_type: string
            - value_asserted: 128MB
            - external_ref: 
                type: chef_attribute
                path: node[postgresql][effective_cache_size]
        - max_connections: !omap 
            - display_name: max_connections
            - data_type: string
            - value_asserted: "100"
            - external_ref: 
                type: chef_attribute
                path: node[postgresql][max_connections]
        - sap_config__l4: !omap 
            - display_name: sap_config__l4
            - description: postgres ip service access point configuration
            - data_type: json
            - value_asserted: 
              - port: 5432
                protocol: tcp
            - is_port: true
            - semantic_type_summary: sap_config__l4
            - semantic_type: 
                ":array": sap_config__l4
            - external_ref: 
                type: service_attribute
                path: service[postgresql][sap_config__l4]
        - shared_buffers: !omap 
            - display_name: shared_buffers
            - data_type: string
            - value_asserted: 28MB
            - external_ref: 
                type: chef_attribute
                path: node[postgresql][shared_buffers]

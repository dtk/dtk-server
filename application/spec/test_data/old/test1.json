{ 
  "component_def": {
    "pg_pool": {
      "attribute_def": {
        "sap_ref": {
          "is_array": true,
          "semantic_type": {
            "sap": {
              "is_array": true,
              "type": "postgresql"
            }
          },
          "data_type": "json",
          "description": "Pg_Pool Service Access Point",
          "display_name": "Pg_Pool SAP",
          "external_attr_ref": "pg_pool/sap_ref",
          "hidden" : false,
          "port_type": "output"
        }
      },
      "display_name": "pg_pool",
      "external_cmp_ref": "pg_pool::set_params",
      "external_type": "chef_recipe"
    },
    "postgresql": {
      "attribute_def": {
        "dir": {
          "default": "/etc/postgresql/8.3/main",
          "data_type": "string",
          "description": "Location of the PostgreSQL databases",
          "display_name": "PostgreSQL Directory",
          "hidden" : false,
          "external_attr_ref": "postgresql/dir"
        },
        "sap": {
          "semantic_type": {
            "sap": {
              "type": "postgresql"
            }
          },
          "data_type": "json",
          "description": "PostgreSQL Service Access Point",
          "display_name": "PostgreSQL SAP",
          "hidden" : true,
          "port_type": "both"
        },
        "sap_config": {
          "semantic_type": {
            "sap_config": {
              "type": "postgresql"
            }
          },
          "default": {
              "network": {
                "port": 5432
              }
          },
          "data_type": "json",
          "description": "PostgreSQL Service Access Point configuration",
          "display_name": "PostgreSQL SAP Config",
          "hidden" : false,
          "external_attr_ref": "postgresql/sap_config",
          "port_type": "input"
        }
      },
      "display_name": "postgresql",
      "external_cmp_ref": "postgresql::server",
      "external_type": "chef_recipe"
    }
  },
  "network_partition" : {
    "tier1" : {
    }
  },
  "node": {
    "pg_pool_plus_pg": {
      "node_interface" : {
        "eth0" : {
	  "*network_partition_id" : "/network_partition/tier1"
        }
      },
      "attribute": {
         "ip_address": {
            "display_name": "Node IP address"
         }
      }

    },
    "pg": {
      "node_interface" : {
        "eth0" : {
	  "*network_partition_id" : "/network_partition/tier1"
        }
      },
      "attribute": {
         "ip_address": {
            "display_name": "Node IP address"
         }
      }
    }
  },
  "assoc_node_component": {
    "assoc": {
      "*component_id": "/component/bundle/component/pg_pool",
      "*node_id": "/node/pg_pool_plus_pg"
    },
    "assoc-2": {
      "*component_id": "/component/bundle/component/postgresql",
      "*node_id": "/node/pg_pool_plus_pg"
    },
    "assoc-3": {
      "*component_id": "/component/bundle/component/postgresql-2",
      "*node_id": "/node/pg"
    }
  },

  "component": {
    "bundle": {
      "component": {
        "pg_pool": {
          "description": "Installs and configures pg_pool",
          "*component_def_id": "/component_def/pg_pool",
          "display_name": "pg_pool",
          "attribute": {
            "sap_ref": {
	      "required" : true,
              "function": {
                "predefined": {
                  "name": "sap_ref_array_from_sap_array",
                  "parameters" : "all"
                }
              },
              "*attribute_def_id": "/component_def/pg_pool/attribute_def/sap_ref",
              "display_name": "Pg_Pool SAP"
            }
          }
        },
        "postgresql-2": {
          "description": "Installs and configures postgresql for clients or servers",
	  "*component_def_id": "/component_def/postgresql",
          "display_name": "postgresql-2",
          "attribute": {
            "sap": {
              "function": {
                "predefined": {
                  "name": "sap_from_config_and_ip",
                  "parameters" : ["1","2"]
                }
              },
              "display_name": "PostgreSQL SAP",
	      "*attribute_def_id": "/component_def/postgresql/attribute_def/sap"
            },
            "sap_config": {
              "value_asserted": {
                  "network": {
                    "port": 5432
                  }
              },
	      "required" : true,
              "display_name": "PostgreSQL SAP",
	      "*attribute_def_id": "/component_def/postgresql/attribute_def/sap_config"
            },
            "dir": {
              "required" : true,
	      "value_asserted": "/etc/postgresql/8.3/main",
              "display_name": "PostgreSQL Directory",
	      "*attribute_def_id": "/component_def/postgresql/attribute_def/dir"
            }
          }
        },
        "postgresql": {
          "description": "Installs and configures postgresql for clients or servers",
          "*component_def_id": "/component_def/postgresql",
          "display_name": "postgresql",
          "attribute": {
            "sap": {
              "function": {
                "predefined": {
                  "name": "sap_from_config_and_ip",
                  "parameters" : ["1","2"]
                }
              },
              "display_name": "PostgreSQL SAP",
	      "*attribute_def_id": "/component_def/postgresql/attribute_def/sap"
            },
            "sap_config": {
	      "required" : true,
  	      "value_asserted": {
                  "network": {
                    "port": 5432
                  }
              },
              "display_name": "PostgreSQL SAP",
	      "*attribute_def_id": "/component_def/postgresql/attribute_def/sap_config"
            },
            "dir": {
	      "required" : true,
              "value_asserted": "/etc/postgresql/8.3/main",
              "display_name": "PostgreSQL Directory",
	      "*attribute_def_id": "/component_def/postgresql/attribute_def/dir"
            }
          }
        }
      },
      "display_name": "bundle",
      "attribute_link": {
        "sap_ref__sap": {
          "*output_id": "/component/bundle/component/pg_pool/attribute/sap_ref",
          "display_name": "sap_ref__sap",
          "label": "1",
          "*input_id": "/component/bundle/component/postgresql/attribute/sap"
        },
        "sap_ref__sap-2": {
          "*output_id": "/component/bundle/component/pg_pool/attribute/sap_ref",
          "display_name": "sap_ref__sap-2",
          "label": "2",
          "*input_id": "/component/bundle/component/postgresql-2/attribute/sap"
        },
        "sap__node_ip": {
          "*output_id": "/component/bundle/component/postgresql/attribute/sap",
          "display_name": "sap__node_ip",
          "label": "1",
          "*input_id":  "/node/pg_pool_plus_pg/attribute/ip_address"
        },
        "sap__sap_config": {
          "*output_id": "/component/bundle/component/postgresql/attribute/sap",
          "display_name": "sap__sap_config",
          "label": "2",
          "*input_id":  "/component/bundle/component/postgresql/attribute/sap_config"
        },
        "sap__node_ip-2": {
          "*output_id": "/component/bundle/component/postgresql-2/attribute/sap",
          "display_name": "sap__node_ip-2",
          "label": "1",
          "*input_id":  "/node/pg/attribute/ip_address"
        },
        "sap__sap_config-2": {
          "*output_id": "/component/bundle/component/postgresql-2/attribute/sap",
          "display_name": "sap__sap_config-2",
          "label": "2",
          "*input_id":  "/component/bundle/component/postgresql-2/attribute/sap_config"
        }
      }
    }
  }
}

---
dsl_version: 1.0.0
name: new_dtk_client_test_case_06
dependencies:
  puppetlabs/apt: master
  puppetlabs/concat: master
  aws/ec2: master
  puppetlabs/mysql: 1.0.0
  puppet/nginx: master
  nanliu/staging: master
  r8/stdlib: master
  dtk-examples/wordpress: 1.2.0
components:
- ec2::node[wordpress]:
    attributes:
      discovered: false
      dtk_debug: false
      enable_public_ip_in_subnet: true
      image: trusty_hvm
      size: small
      tags:
        Name: dtk:new_dtk_client_test_case_06:wordpress
    links:
    - target_iam/ec2::profile[aws-target]
    components:
    - mysql::server:
        attributes:
          remote_access: false
    - mysql::db[wordpress]
    - wordpress::app:
        attributes:
          db_name: wordpress
          db_password: password
          db_user: user
          version: '3.8'
        links:
        - ec2::node[wordpress]/mysql::db[wordpress]
        - ec2::node[wordpress]/mysql::server
    - wordpress::php_config
    - wordpress::nginx_config:
        attributes:
          wp_content: /opt/wordpress/
actions:
  create:
    subtask_order: sequential
    subtasks:
    - name: component ec2::node[wordpress]
      ordered_components:
      - ec2::node[wordpress]
    - name: wordpress setup
      ordered_components:
      - wordpress::php_config
      - wordpress::app
    - name: database setup
      ordered_components:
      - mysql::server
      - mysql::db[wordpress]
    - name: web server setup
      ordered_components:
      - wordpress::nginx_config